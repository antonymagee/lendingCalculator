<!DOCTYPE html>  
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="AFSC Loan Calculator">
  <meta name="author" content="Antony Magee">
  <link rel="icon" href="afsc-favicon.ico">


<title>AFSC Loan Calculatortrurjhg</title>
<link href="signin.css" rel="stylesheet">

  <link href="css/bootstrap.css" rel="stylesheet">
  <link href="https://code.jquery.com/ui/1.12.0-rc.2/themes/smoothness/jquery-ui.css" rel="stylesheet">  
</head>
<body>
<div class="container">
        <div class="col-6 col-centered">
            <h3>
                Loan Payment Calculator
                <small id="para1" class="text-muted"></small>
            </h3>
            <div class="form-group">
                <label for="loanAmount">Loan Amount</label>
                <div class="input-group">
                    <div class="input-group-addon">$</div>
                    <input  class="form-control validate" maxlength="11" id="amount" placeholder="$10,000 minimum">
                </div>
            </div>
            <div class="form-group">
            <label for="exampleSelect1">Loan Type</label>
            <select class="form-control" id="exampleSelect1">
            <option value="" selected disabled>Select Type</option>
            <option>Alberta Farm Loan</option>
            <option>Agribusinessâ€“Non Agribusiness</option>
            <option>Commercial Loan</option>
            <option>Revolving Loan-Farm</option>
            <option>Value Added</option>
            <option>Value Added & Agribusiness-Agribusiness</option>
          </select>
          </div>

            <div class="form-group">
                <label for="annualInterest">Annual interest</label>
                <div class="input-group">
                    <div class="input-group-addon">%</div>
                    <input class="form-control validate" id="apr">
                </div>
            </div>
         <div class="form-group">
            <label for="loanAmount">Loan Term</label>
            <div id="sliderInput" class="input-group">
              <input id="ex19" type="text" />
            </div>
          </div>     
 <!-- 
    Beginning of Results Cards
  -->
<div class="card-group">
        <div class="card">
            <div class="card-header">Quartely</div>
            <div class="card-block">
                <h4 class="card-title" id="quartelyPayment"></h4>
            </div>
        </div>
        <div class="card">
            <div class="card-header">Yearly Payment</div>
            <div class="card-block">        
                <h4 class="card-title" id="yearlyPayment"></h4>
            </div>
        </div>  
        <div class="card">
            <div class="card-header">Total</div>
            <div class="card-block">     
                <h4 class="card-title"  id="total" ></h4>
            </div>
        </div>
 <!-- End of First card block -->       
</div>

<div class="card-group">
        <div class="card">
            <div class="card-header">Monthly</div>
            <div class="card-block">
                <h4 class="card-title" id="payment"></h4>
            </div>
        </div>
        <div class="card">
            <div class="card-header">Semi-Annual</div>
            <div class="card-block">
                <h4 class="card-title" id="semiPayment"></h4>
            </div>
        </div>
        <div class="card">
            <div class="card-header">Total Interest</div>
            <div class="card-block">
                <h4 class="card-title"  id="totalinterest"></h4>
            </div>
        </div>
<!-- End of Second card Block -->
</div>
        <div class="card">
            <div class="card-header">Repayment Distribution</div>
            <div class="card-block">
                <p class="card-text"></p>
                <h5 class="card-title"></h5>
                <canvas id="graph" width="400" height="250"></canvas>
            </div>
        </div>
      <!-- End of Central Coloumn -->
    </div>
    <!-- End of Container -->
</div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>

  <link href="signin.css" rel="stylesheet">
  <link href="css/bootstrap.css" rel="stylesheet">

  <link href="css/bootstrap-slider.css" rel="stylesheet">
  <script src="js/bootstrap-slider.js"></script>


<script>
"use strict"; // Use ECMAScript 5 strict mode in browsers that support it

    $(function () {
      // Instantiate a slider
      $("#ex19").bootstrapSlider
        ({
          ticks: [1, 2, 3, 4, 5],
          ticks_labels: ["1", "3", "5", "10", "20"],
          min: 1,
          max: 5,
          step: 1,
          value: 1,
        });
    
// used when the slider toggle stops moving to update the value onStop
// also calls the caculate() function to update the total displayed numbers      
$("#ex19").on("slideStop", function(){
calculate()
});

// same as above but this will trigger when the toggle si slid
$("#ex19").on("slide", function(){
calculate()
	    });

$('#amount').keypress(function(e) {
    if(e.keyCode==13){
        alert('You pressed enter!');
        calculate()
    }
});       

/*
 * This script defines the calculate() function called by the event handlers
 * in HTML above. The function reads values from <input> elements, calculates
 * loan payment information, displays the results in <span> elements. It also
 * saves the user's data, displays links to lenders, and draws a chart.
 */
function calculate() {
    // Look up the input and output elements in the document
    var amount = document.getElementById("amount");
    var apr = document.getElementById("apr");
    var years = document.getElementById("ex19");

    var payment = document.getElementById("payment");
    var total = document.getElementById("total");
    var totalinterest = document.getElementById("totalinterest");
    
    // Get the user's input from the input elements. Assume it is all valid.
    // Convert interest from a percentage to a decimal, and convert from
    // an annual rate to a monthly rate. Convert payment period in years
    // to the number of monthly payments.
    var principal = parseFloat(amount.value);
    var interest = parseFloat(apr.value) / 100 / 12;
    var payments = parseFloat(years.value) * 12;

    // Now compute the monthly payment figure.
    var x = Math.pow(1 + interest, payments);   // Math.pow() computes powers
    var monthly = (principal*x*interest)/(x-1);

    // If the result is a finite number, the user's input was good and
    // we have meaningful results to display
    if (isFinite(monthly)) {
        // Fill in the output fields, rounding to 2 decimal places
        quartelyPayment.innerHTML = "$" + (monthly * 4).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
        semiPayment.innerHTML = "$" + (monthly * 6).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
        yearlyPayment.innerHTML = "$" + (monthly * 12).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');

        payment.innerHTML = "$" + monthly.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
        total.innerHTML = "$" + (monthly * payments).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
        totalinterest.innerHTML = "$" + ((monthly*payments)-principal).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');

        // Save the user's input so we can restore it the next time they visit
        // save(amount.value, apr.value, years.value);


        // Draw Chart
        chart(principal, interest, monthly, payments);
    }
    else {  
        // Result was Not-a-Number or infinite, which means the input was
        // incomplete or invalid. Clear any previously displayed output.
        quartelyPayment.innerHTML = "";
        payment.innerHTML = "";        // Erase the content of these elements
        total.innerHTML = ""
        totalinterest.innerHTML = "";
        chart();                       // With no arguments, clears the chart
    }
}

// Save the user's input as properties of the localStorage object. Those
// properties will still be there when the user visits in the future
// This storage feature will not work in some browsers (Firefox, e.g.) if you 
/*// run the example from a local file:// URL.  It does work over HTTP, however.
function save(amount, apr, years) {
    if (window.localStorage) {  // Only do this if the browser supports it
        localStorage.loan_amount = amount;
        localStorage.loan_apr = apr;
        localStorage.loan_years = years;

    }
}*/

// Select your input element.
var number = document.getElementById('amount');

// Listen for input event on numInput. This block filters out keystrokes not from the 
// num pad or the upper numbers keys
number.onkeydown = function(e) {
    if(!((e.keyCode > 95 && e.keyCode < 106)
      || (e.keyCode > 47 && e.keyCode < 58) 
      || e.keyCode == 8)) {
        return false;
    }
}

// Automatically attempt to restore input fields when the document first loads.
/*window.onload = function() {
    // If the browser supports localStorage and we have some stored data
    if (window.localStorage && localStorage.loan_amount) {  
        document.getElementById("amount").value = localStorage.loan_amount;
        document.getElementById("apr").value = localStorage.loan_apr;
        document.getElementById("ex19").value = localStorage.loan_years;

    }
};*/


// Chart monthly loan balance, interest and equity in an HTML <canvas> element.
// If called with no arguments then just erase any previously drawn chart.
function chart(principal, interest, monthly, payments) {
    var graph = document.getElementById("graph"); // Get the <canvas> tag
    graph.width = graph.width;  // Magic to clear and reset the canvas element

    // If we're called with no arguments, or if this browser does not support
    // graphics in a <canvas> element, then just return now.
    if (arguments.length == 0 || !graph.getContext) return;

    // Get the "context" object for the <canvas> that defines the drawing API
    var g = graph.getContext("2d"); // All drawing is done with this object
    var width = graph.width, height = graph.height; // Get canvas size

    // These functions convert payment numbers and dollar amounts to pixels
    function paymentToX(n) { return n * width/payments; }
    function amountToY(a) { return height-(a * height/(monthly*payments*1.05));}

    // Payments are a straight line from (0,0) to (payments, monthly*payments)
    g.moveTo(paymentToX(0), amountToY(0));         // Start at lower left
    g.lineTo(paymentToX(payments),                 // Draw to upper right
             amountToY(monthly*payments));
    g.lineTo(paymentToX(payments), amountToY(0));  // Down to lower right
    g.closePath();                                 // And back to start
    g.fillStyle = "#4bbacc";                          // Light red
    g.fill();                                      // Fill the triangle
    g.font = "bold 12px sans-serif";               // Define a font
    g.fillText("Total Interest Payments", 20,20);  // Draw text in legend

    // Cumulative equity is non-linear and trickier to chart
    var equity = 0;
    g.beginPath();                                 // Begin a new shape
    g.moveTo(paymentToX(0), amountToY(0));         // starting at lower-left
    for(var p = 1; p <= payments; p++) {
        // For each payment, figure out how much is interest
        var thisMonthsInterest = (principal-equity)*interest;
        equity += (monthly - thisMonthsInterest);  // The rest goes to equity
        g.lineTo(paymentToX(p),amountToY(equity)); // Line to this point
    }
    g.lineTo(paymentToX(payments), amountToY(0));  // Line back to X axis
    g.closePath();                                 // And back to start point
    g.fillStyle = "#3aa849";                         // Now use green paint
    g.fill();                                      // And fill area under curve
    g.fillText("Total Equity", 20,35);             // Label it in green

    // Loop again, as above, but chart loan balance as a thick black line
    var bal = principal;
    g.beginPath();
    g.moveTo(paymentToX(0),amountToY(bal));
    for(var p = 1; p <= payments; p++) {
        var thisMonthsInterest = bal*interest;
        bal -= (monthly - thisMonthsInterest);     // The rest goes to equity
        g.lineTo(paymentToX(p),amountToY(bal));    // Draw line to this point
    }
    g.lineWidth = 3;                               // Use a thick line
    g.stroke();                                    // Draw the balance curve
    g.fillStyle = "black";                         // Switch to black text
    g.fillText("Loan Balance", 20,50);             // Legend entry

    // Now make yearly tick marks and year numbers on X axis
    g.textAlign="center";                          // Center text over ticks
    var y = amountToY(0);                          // Y coordinate of X axis
    for(var year=1; year*12 <= payments; year++) { // For each year
        var x = paymentToX(year*12);               // Compute tick position
        g.fillRect(x-0.5,y-3,1,3);                 // Draw the tick
        if (year == 1) g.fillText("Year", x, y-5); // Label the axis
        if (year % 5 == 0 && year*12 !== payments) // Number every 5 years
            g.fillText(String(year), x, y-5);
    }

    // Mark payment amounts along the right edge
    g.textAlign = "right";                         // Right-justify text
    g.textBaseline = "middle";                     // Center it vertically
    var ticks = [monthly*payments, principal];     // The two points we'll mark
    var rightEdge = paymentToX(payments);          // X coordinate of Y axis
    for(var i = 0; i < ticks.length; i++) {        // For each of the 2 points
        var y = amountToY(ticks[i]);               // Compute Y position of tick
        g.fillRect(rightEdge-3, y-0.5, 3,1);       // Draw the tick mark
        g.fillText(String(ticks[i].toFixed(0)),    // And label it.
                   rightEdge-5, y);
    }
}

    // caculates the date for the top of the page
    document.getElementById("para1").innerHTML = formatAMPM();
    function formatAMPM() {
      var d = new Date(),
        months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
        days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      return d.getDate() + ' ' + months[d.getMonth()] + ' ' + d.getFullYear();
    }

// end of $ function
});

</script>

</body>
</html>
